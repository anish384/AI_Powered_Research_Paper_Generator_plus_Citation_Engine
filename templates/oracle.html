{% extends "base.html" %}

{% block title %}Research Oracle{% endblock %}

{% block content %}
<div class="oracle-container">
    <h1>üîÆ Research Oracle</h1>
    <p class="oracle-subtitle">Peer into the future of research and discover hidden knowledge patterns</p>

    <div class="oracle-sections">
        <!-- Divine Future Section -->
        <div class="oracle-section">
            <h2>üåü Divine Research Future</h2>
            <div class="input-group">
                <textarea id="oracle-query" placeholder="Ask the Oracle about research mysteries..." rows="3"></textarea>
                <button id="divine-btn" class="oracle-btn">Consult Oracle</button>
            </div>
            <div id="prophecy-result" class="oracle-result"></div>
        </div>

        <!-- Trend Prediction Section -->
        <div class="oracle-section">
            <h2>üìà Predict Research Trends</h2>
            <div class="input-group">
                <input type="text" id="trend-field" placeholder="Research field (e.g., AI, Biology)">
                <select id="timeframe">
                    <option value="2024-2025">2024-2025</option>
                    <option value="2024-2027">2024-2027</option>
                    <option value="2024-2030">2024-2030</option>
                </select>
                <button id="predict-trends-btn" class="oracle-btn">Predict Trends</button>
            </div>
            <div id="trends-result" class="oracle-result"></div>
        </div>

        <!-- Evolution Map Section -->
        <div class="oracle-section">
            <h2>üó∫Ô∏è Research Evolution Map</h2>
            <div class="input-group">
                <input type="text" id="evolution-topic" placeholder="Research topic to map">
                <button id="evolution-btn" class="oracle-btn">Create Map</button>
            </div>
            <div id="evolution-result" class="oracle-result"></div>
        </div>

        <!-- Ultimate Vision Section -->
        <div class="oracle-section">
            <h2>‚ú® Ultimate Research Vision</h2>
            <div class="input-group">
                <input type="text" id="vision-field" placeholder="Field for ultimate vision">
                <button id="vision-btn" class="oracle-btn">Generate Vision</button>
            </div>
            <div id="vision-result" class="oracle-result"></div>
        </div>

        <!-- Synchronicity Section -->
        <div class="oracle-section">
            <h2>üåÄ Research Synchronicity</h2>
            <div class="input-group">
                <input type="text" id="sync-topic1" placeholder="First research area">
                <input type="text" id="sync-topic2" placeholder="Second research area">
                <button id="sync-btn" class="oracle-btn">Predict Synchronicity</button>
            </div>
            <div id="sync-result" class="oracle-result"></div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <p>üîÆ The Oracle is consulting the cosmic research patterns...</p>
    </div>
</div>

<style>
.oracle-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: white;
}

.oracle-subtitle {
    text-align: center;
    font-style: italic;
    margin-bottom: 30px;
    opacity: 0.9;
}

.oracle-sections {
    display: grid;
    gap: 25px;
}

.oracle-section {
    background: rgba(255, 255, 255, 0.1);
    padding: 20px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.oracle-section h2 {
    margin-bottom: 15px;
    color: #ffd700;
}

.input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.input-group input, .input-group textarea, .input-group select {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    min-width: 200px;
}

.oracle-btn {
    padding: 10px 20px;
    background: linear-gradient(45deg, #ffd700, #ffed4e);
    color: #333;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s;
}

.oracle-btn:hover {
    transform: scale(1.05);
}

.oracle-result {
    background: rgba(0, 0, 0, 0.3);
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
    display: none;
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
}

.loading {
    text-align: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    margin-top: 20px;
}
</style>

<script>
class OracleInterface {
    constructor() {
        this.initializeEventListeners();
    }

    initializeEventListeners() {
        document.getElementById('divine-btn').addEventListener('click', () => this.divineResearch());
        document.getElementById('predict-trends-btn').addEventListener('click', () => this.predictTrends());
        document.getElementById('evolution-btn').addEventListener('click', () => this.createEvolutionMap());
        document.getElementById('vision-btn').addEventListener('click', () => this.generateVision());
        document.getElementById('sync-btn').addEventListener('click', () => this.predictSynchronicity());
    }

    async divineResearch() {
        const query = document.getElementById('oracle-query').value;
        if (!query) return alert('Ask the Oracle a question!');

        this.showLoading();
        try {
            const response = await fetch('/api/oracle/divine', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({query})
            });
            const result = await response.json();
            
            if (result.success) {
                this.displayResult('prophecy-result', result.prophecy);
            } else {
                alert('Oracle error: ' + result.error);
            }
        } catch (error) {
            alert('Oracle connection failed: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }

    async predictTrends() {
        const field = document.getElementById('trend-field').value;
        const timeframe = document.getElementById('timeframe').value;
        if (!field) return alert('Enter a research field!');

        this.showLoading();
        try {
            const response = await fetch('/api/oracle/predict-trends', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({field, timeframe})
            });
            const result = await response.json();
            
            if (result.success) {
                const content = `TRENDS:\n${result.trends}\n\nFUTURE CONCEPTS:\n${result.future_concepts}`;
                this.displayResult('trends-result', content);
            } else {
                alert('Trend prediction failed: ' + result.error);
            }
        } catch (error) {
            alert('Prediction failed: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }

    async createEvolutionMap() {
        const topic = document.getElementById('evolution-topic').value;
        if (!topic) return alert('Enter a research topic!');

        this.showLoading();
        try {
            const response = await fetch('/api/oracle/evolution-map', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({topic})
            });
            const result = await response.json();
            
            if (result.success) {
                const content = `TIMELINE:\n${result.timeline}\n\nECOSYSTEM:\n${result.ecosystem}\n\nMUTATIONS:\n${result.mutations}`;
                this.displayResult('evolution-result', content);
            } else {
                alert('Evolution map failed: ' + result.error);
            }
        } catch (error) {
            alert('Map creation failed: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }

    async generateVision() {
        const field = document.getElementById('vision-field').value;
        if (!field) return alert('Enter a research field!');

        this.showLoading();
        try {
            const response = await fetch('/api/oracle/ultimate-vision', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({field})
            });
            const result = await response.json();
            
            if (result.success) {
                const content = `ULTIMATE VISION:\n${result.ultimate_vision.ultimate_vision}\n\nRESEARCH MANDALA:\n${result.research_mandala}`;
                this.displayResult('vision-result', content);
            } else {
                alert('Vision generation failed: ' + result.error);
            }
        } catch (error) {
            alert('Vision failed: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }

    async predictSynchronicity() {
        const topic1 = document.getElementById('sync-topic1').value;
        const topic2 = document.getElementById('sync-topic2').value;
        if (!topic1 || !topic2) return alert('Enter both research areas!');

        this.showLoading();
        try {
            const response = await fetch('/api/oracle/synchronicity', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({topic1, topic2})
            });
            const result = await response.json();
            
            if (result.success) {
                const content = `SYNCHRONICITY:\n${result.synchronicity}\n\nFUSION IDEAS:\n${result.fusion_ideas}`;
                this.displayResult('sync-result', content);
            } else {
                alert('Synchronicity prediction failed: ' + result.error);
            }
        } catch (error) {
            alert('Synchronicity failed: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }

    displayResult(elementId, content) {
        const element = document.getElementById(elementId);
        element.textContent = content;
        element.style.display = 'block';
    }

    showLoading() {
        document.getElementById('loading').style.display = 'block';
    }

    hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }
}

document.addEventListener('DOMContentLoaded', () => new OracleInterface());
</script>
{% endblock %}